<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>G-Checkout</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-start: #E74C3C;
      --primary-end: #8E24AA;
      --primary-gradient: linear-gradient(90deg, var(--primary-start) 0%, var(--primary-end) 100%);
      --error-color: #C62828;
      --bg-light: #FFFFFF;
      --card-bg: #F9FAFB;
      --text-dark: #1F2937;
      --font-base: 'Montserrat', sans-serif;
      --transition: 0.3s ease;
      --border-radius: 8px;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: var(--font-base);
      background: var(--card-bg);
      color: var(--text-dark);
    }
    header {
      background: var(--primary-gradient);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2rem 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header .logo-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    header img.logo {
      height: 40px;
    }
    header span.title {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .container {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    .left, .right {
      background: var(--bg-light);
      overflow-y: auto;
      padding: 2rem;
    }
    .left {
      width: 65%;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      border-right: 1px solid #E5E7EB;
    }
    .right {
      width: 35%;
    }
    .boxes {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .box {
      flex: 1;
      background: var(--card-bg);
      border: 1px solid #E5E7EB;
      border-radius: var(--border-radius);
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .box h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1rem;
    }
    .box p {
      margin: 0.25rem 0;
      font-size: 1.1rem;
    }
    .photos {
      display: flex;
      gap: 1rem;
    }
    .foto {
      flex: 1;
      background: var(--bg-light);
      border-radius: var(--border-radius);
      height: 220px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: transform var(--transition);
    }
    .foto:hover { transform: translateY(-4px); }
    .foto img { max-height: 100%; max-width: 100%; }
    .product-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }
    .product-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--bg-light);
      border-radius: var(--border-radius);
      border: 1px solid #E5E7EB;
      transition: background-color var(--transition), transform var(--transition);
    }
    .product-row:hover { transform: translateX(4px); }
    .product-row span.name { font-weight: 600; }
    .product-row span.qty { font-size: 0.95rem; color: #6B7280; }
    .product-row.switch-error,
    .product-row.object-error { background-color: rgba(231,76,60,0.1); border-color: var(--error-color); }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="./grabit_logo.png" alt="G-Checkout Logo" class="logo">
      <span class="title">G-Checkout</span>
    </div>
  </header>
  <div class="container">
    <div class="left">
      <div class="boxes">
        <div class="box" id="scanned-box">
          <h3>Scanned</h3>
          <p><strong>Product:</strong> <span id="scanned-name">...</span></p>
          <p><strong>Detected obj:</strong> <span id="scanned-obj">...</span></p>
        </div>
        <div class="box" id="prediction-box">
          <h3>Prediction</h3>
          <p><strong>Predicted:</strong> <span id="pred-name">...</span></p>
          <img id="pred-img" src="" alt="Predicted Image" style="width:100%;border-radius:var(--border-radius);margin-top:0.5rem;display:none;" />
        </div>
      </div>
      <div class="photos">
        <div class="foto" id="foto1"><span>Loading...</span></div>
        <div class="foto" id="foto2"><span>Loading...</span></div>
      </div>
      <div class="product-list" id="product-list"></div>
    </div>
    <div class="right">
      <!-- Sidebar or additional content -->
    </div>
  </div>
  <script>
    const nameMap = {
      "F8411273011440": "PlÃ¡tano",
      "F5449000131805": "Coca-Cola Zero Lata",
      "F3046920028363": "Lindt Excellence 85%",
    };
    const localImages = { "F8411273011440": "./banana.png" };
    const scanCounts = {};
    const ws = new WebSocket("ws://app.grabit.ai/ws/get_reference_ean");
    ws.onmessage = ({ data }) => {
      const json = JSON.parse(data);
      const status = json.detection_status || {};
      const images = status.images || {};
      const det = json.detection?.[0] || {};
      const objectErr = !images.object_1;
      const switchErr = status.trigger===true||status.detected_ean!==status.reference_ean;
      const scannedName = nameMap[det.reference_ean]||"Desconocido";
      const scannedObj = det.detected_ean||"N/A";
      document.getElementById("scanned-name").textContent = scannedName;
      document.getElementById("scanned-obj").textContent = scannedObj;
      const predEan = status.detected_ean||"";
      const predName = nameMap[predEan]||"Desconocido";
      document.getElementById("pred-name").textContent = predName;
      const predImg = localImages[predEan];
      const predImgEl=document.getElementById("pred-img");
      if(predImg){predImgEl.src=predImg;predImgEl.style.display="block";}else{predImgEl.style.display="none";}
      const scannedBox=document.getElementById("scanned-box");
      scannedBox.classList.toggle("object-error",objectErr);
      scannedBox.classList.toggle("switch-error",!objectErr&&switchErr);
      const foto1El=document.getElementById("foto1");
      foto1El.innerHTML=images.source_image?`<img src="${images.source_image}" alt="Source Image">`:`<span style="color:var(--error-color);font-weight:bold;">ERROR</span>`;
      const foto2El=document.getElementById("foto2");
      foto2El.innerHTML=images.object_1?`<img src="${images.object_1}" alt="Detected Object">`:`<span style="color:var(--error-color);font-weight:bold;">OBJECT NOT DETECTED</span>`;
      scanCounts[scannedName]=(scanCounts[scannedName]||0)+1;
      const list=document.getElementById("product-list");list.innerHTML="";
      for(const[name,qty] of Object.entries(scanCounts)){
        const row=document.createElement("div");row.className="product-row";
        if(name===scannedName&&(objectErr||switchErr))row.classList.add(objectErr?"object-error":"switch-error");
        row.innerHTML=`<span class="name">${name}</span><span class="qty">x${qty}</span>`;
        list.appendChild(row);
      }
    };
    ws.onerror=err=>console.error(err);
  </script>
</body>
</html>
